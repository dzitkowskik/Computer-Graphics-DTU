<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>02561 E14 - WebGL #4</title>


    <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec3 position;
    attribute vec3 normal;

    uniform mat4 ModelView;
    uniform mat4 Projection;

    varying vec3 N;
    varying vec3 v; 

    void main()
    {
        v = vec3(ModelView * vec4(position, 1.0));       
        N = vec3(ModelView * vec4(normal, 0.0));   
        gl_Position = Projection * ModelView * vec4(position, 1.0);
    }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;
    uniform vec4 LightPosition;
    varying vec3 N;
    varying vec3 v; 

    void main()
    {
        //material and light
        vec4 Ambient = vec4(0.2, 0.0, 0.2, 1.0);
        vec4 Diffuse = vec4(1.0, 0.8, 0.0, 1.0);
        vec4 Specular = vec4(1.0, 0.8, 0.0, 1.0);
        float Shininess = 100.0;
        
        float Kd = 0.6;
        float Ks = 0.4;
        vec3 lp = vec3(LightPosition);
        vec3 L = normalize(lp - v);
        if(LightPosition.w == 0.0)
        {
            L = normalize(lp);
        }
           
        vec3 E = normalize(v);
        vec3 R = normalize(reflect(L,N));  

        //calculate Diffuse Term:  
        vec4 Idiff = Diffuse * max(dot(N,L), 0.0);
        Idiff = clamp(Idiff, 0.0, 1.0);     
   
        // calculate Specular Term:
        vec4 Ispec = Specular * pow(max(dot(R,E),0.0),0.3*Shininess);
        Ispec = clamp(Ispec, 0.0, 1.0); 

        // write Total Color:  
        gl_FragColor = Ambient + Kd * Idiff + Ks * Ispec;   
        //gl_FragColor = vec4(lp, 1.0);
    }
    </script>


    <script>
        // model data - converted using http://www.kickjs.org/tool/model_tool/model_tool.html
        var sphereData = [{
            "vertex": [-0.8660249710083008, 0.5, 0, -0.5, 0.8660249710083008, 0, -0.433012992143631, 0.8660249710083008, -0.25, -0.75, 0.5, -0.433012992143631, -0.8660249710083008, 0, -0.5, -0.75, -0.5, -0.433012992143631, -0.8660249710083008, -0.5, 0, -1, 0, 0, -0.433012992143631, -0.8660249710083008, -0.25, -0.5, -0.8660249710083008, 0, -0.433012992143631, 0.5, -0.75, -0.5, 0, -0.8660249710083008, -0.433012992143631, -0.5, -0.75, -0.25, -0.8660249710083008, -0.433012992143631, -0.25, 0.8660249710083008, -0.433012992143631, 0, -0.5, -0.8660249710083008, 0, -0.8660249710083008, -0.5, 0, 0.8660249710083008, -0.5, 0, 0.5, -0.8660249710083008, 0, 0, -1, 0.5, 0, -0.8660249710083008, 0.4330120086669922, -0.5, -0.75, 0.4330120086669922, 0.5, -0.75, 0.25, -0.8660249710083008, -0.433012992143631, 0.25, 0.8660249710083008, -0.433012992143631, 0.75, 0.5, -0.433012992143631, 0.8660249710083008, 0, -0.5, 0.75, -0.5, -0.433012992143631, 0.4330120086669922, -0.8660249710083008, -0.25, 0.4330120086669922, 0.8660249710083008, -0.25, 0.5, 0.8660249710083008, 0, 0.8660249710083008, 0.5, 0, 1, 0, 0, 0.8660249710083008, -0.5, 0, 0.5, -0.8660249710083008, 0, 0.8660249710083008, 0, 0.5, 0.75, -0.5, 0.433012992143631, 0.75, 0.5, 0.433012992143631, 0.4330120086669922, -0.8660249710083008, 0.25, 0.4330120086669922, 0.8660249710083008, 0.25, 0.4330120086669922, 0.5, 0.75, 0.5, 0, 0.8660249710083008, 0.4330120086669922, -0.5, 0.75, 0.25, -0.8660249710083008, 0.433012992143631, 0.25, 0.8660249710083008, 0.433012992143631, 0, 0.8660249710083008, 0.5, 0, 0.5, 0.8660249710083008, 0, 0, 1, 0, -0.5, 0.8660249710083008, 0, -0.8660249710083008, 0.5, -0.433012992143631, 0.5, 0.75, -0.5, 0, 0.8660249710083008, -0.433012992143631, -0.5, 0.75, -0.25, -0.8660249710083008, 0.433012992143631, -0.25, 0.8660249710083008, 0.433012992143631, -0.75, 0.5, 0.433012992143631, -0.8660249710083008, 0, 0.5, -0.75, -0.5, 0.4330120086669922, -0.433012992143631, -0.8660249710083008, 0.25, -0.433012992143631, 0.8660249710083008, 0.25, 0, -1, 0, 0, 1, 0],
            "name": "sphere_low-res",
            "indices0": [0, 1, 2, 2, 3, 0, 4, 5, 6, 6, 7, 4, 3, 4, 7, 7, 0, 3, 5, 8, 9, 9, 6, 5, 10, 11, 4, 4, 3, 10, 12, 13, 8, 8, 5, 12, 14, 10, 3, 3, 2, 14, 11, 12, 5, 5, 4, 11, 15, 16, 13, 13, 12, 15, 17, 18, 10, 10, 14, 17, 19, 15, 12, 12, 11, 19, 18, 19, 11, 11, 10, 18, 20, 21, 15, 15, 19, 20, 22, 20, 19, 19, 18, 22, 21, 23, 16, 16, 15, 21, 24, 22, 18, 18, 17, 24, 25, 26, 20, 20, 22, 25, 27, 28, 23, 23, 21, 27, 29, 25, 22, 22, 24, 29, 26, 27, 21, 21, 20, 26, 30, 31, 25, 25, 29, 30, 32, 33, 27, 27, 26, 32, 31, 32, 26, 26, 25, 31, 33, 34, 28, 28, 27, 33, 35, 36, 33, 33, 32, 35, 37, 35, 32, 32, 31, 37, 36, 38, 34, 34, 33, 36, 39, 37, 31, 31, 30, 39, 40, 41, 35, 35, 37, 40, 42, 43, 38, 38, 36, 42, 44, 40, 37, 37, 39, 44, 41, 42, 36, 36, 35, 41, 45, 46, 40, 40, 44, 45, 47, 48, 42, 42, 41, 47, 46, 47, 41, 41, 40, 46, 48, 49, 43, 43, 42, 48, 50, 51, 47, 47, 46, 50, 52, 53, 49, 49, 48, 52, 54, 50, 46, 46, 45, 54, 51, 52, 48, 48, 47, 51, 55, 56, 51, 51, 50, 55, 57, 58, 53, 53, 52, 57, 59, 55, 50, 50, 54, 59, 56, 57, 52, 52, 51, 56, 8, 60, 9, 2, 1, 61, 61, 14, 2, 13, 60, 8, 16, 60, 13, 61, 17, 14, 23, 60, 16, 61, 24, 17, 28, 60, 23, 61, 29, 24, 34, 60, 28, 61, 30, 29, 38, 60, 34, 61, 39, 30, 43, 60, 38, 61, 44, 39, 49, 60, 43, 61, 45, 44, 53, 60, 49, 61, 54, 45, 58, 60, 53, 61, 59, 54, 1, 0, 55, 55, 59, 1, 7, 6, 57, 57, 56, 7, 9, 60, 58, 61, 1, 59, 0, 7, 56, 56, 55, 0, 6, 9, 58, 58, 57, 6],
            "normal": [-0.8759729862213135, 0.4823150038719177, 0, -0.5308690071105957, 0.8474069833755493, 0, -0.45976099371910095, 0.8474069833755493, -0.26541900634765625, -0.7585989832878113, 0.4823150038719177, -0.43797099590301513, -0.8660240173339844, 0, -0.499985009431839, -0.7585989832878113, -0.4823150038719177, -0.43797099590301513, -0.8759729862213135, -0.4823150038719177, 0, -1, 0, 0, -0.45976099371910095, -0.8474069833755493, -0.26541900634765625, -0.5308690071105957, -0.8474069833755493, 0, -0.43797099590301513, 0.4823150038719177, -0.7585989832878113, -0.499985009431839, 0, -0.8660240173339844, -0.43797099590301513, -0.4823150038719177, -0.7585989832878113, -0.26541900634765625, -0.8474069833755493, -0.45976099371910095, -0.26541900634765625, 0.8474069833755493, -0.45976099371910095, 0, -0.4823150038719177, -0.8759729862213135, 0, -0.8474069833755493, -0.5308690071105957, 0, 0.8474069833755493, -0.5308690071105957, 0, 0.4823150038719177, -0.8759729862213135, 0, 0, -1, 0.499985009431839, 0, -0.8660240173339844, 0.43797099590301513, -0.4823150038719177, -0.7585989832878113, 0.43797099590301513, 0.4823150038719177, -0.7585989832878113, 0.26545000076293945, -0.8474069833755493, -0.45976099371910095, 0.26541900634765625, 0.8474069833755493, -0.45976099371910095, 0.7585989832878113, 0.4823150038719177, -0.43797099590301513, 0.8660240173339844, 0, -0.499985009431839, 0.7585989832878113, -0.4823150038719177, -0.43797099590301513, 0.45976099371910095, -0.8474069833755493, -0.26541900634765625, 0.45976099371910095, 0.8474069833755493, -0.26541900634765625, 0.5308690071105957, 0.8474069833755493, 0, 0.8759729862213135, 0.4823150038719177, 0, 1, 0, 0, 0.8759729862213135, -0.4823150038719177, 0, 0.5308690071105957, -0.8474069833755493, 0, 0.8660240173339844, 0, 0.499985009431839, 0.7585989832878113, -0.4823150038719177, 0.43797099590301513, 0.7585989832878113, 0.4823150038719177, 0.43797099590301513, 0.45976099371910095, -0.8474069833755493, 0.26545000076293945, 0.45976099371910095, 0.8474069833755493, 0.26541900634765625, 0.43797099590301513, 0.4823150038719177, 0.7585989832878113, 0.499985009431839, 0, 0.8660240173339844, 0.43797099590301513, -0.4823150038719177, 0.7585989832878113, 0.26541900634765625, -0.8474069833755493, 0.45976099371910095, 0.26541900634765625, 0.8474069833755493, 0.45976099371910095, 0, 0.8474069833755493, 0.5308690071105957, 0, 0.4823150038719177, 0.8759729862213135, 0, 0, 1, 0, -0.4823150038719177, 0.8759729862213135, 0, -0.8474069833755493, 0.5308690071105957, -0.43797099590301513, 0.4823150038719177, 0.7585989832878113, -0.499985009431839, 0, 0.8660240173339844, -0.43797099590301513, -0.4823150038719177, 0.7585989832878113, -0.26545000076293945, -0.8474069833755493, 0.45976099371910095, -0.26541900634765625, 0.8474069833755493, 0.45976099371910095, -0.7585989832878113, 0.4823150038719177, 0.43797099590301513, -0.8660240173339844, 0, 0.499985009431839, -0.7585989832878113, -0.4823150038719177, 0.43797099590301513, -0.45976099371910095, -0.8474069833755493, 0.26541900634765625, -0.45976099371910095, 0.8474069833755493, 0.26541900634765625, 0, -1, 0, 0, 1, 0],
            "uv1": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }];
    </script>

    <script>
        // model data - converted using http://www.kickjs.org/tool/model_tool/model_tool.html
        var boxData = [{
            "vertex": [1, 1, -1, 1, -1, -1, -1, -0.9999998211860657, -1, -0.9999997019767761, 1, -1, 1, 0.9999995231628418, 1, -1, 1, 1, -1, -0.9999997019767761, 1, 0.9999994039535522, -1.0000009536743164, 1, 1, 1, -1, 1, 0.9999995231628418, 1, 0.9999994039535522, -1.0000009536743164, 1, 1, -1, -1, 1, -1, -1, 0.9999994039535522, -1.0000009536743164, 1, -1, -0.9999997019767761, 1, -1, -0.9999998211860657, -1, -1, -0.9999998211860657, -1, -1, -0.9999997019767761, 1, -1, 1, 1, -0.9999997019767761, 1, -1, 1, 0.9999995231628418, 1, 1, 1, -1, -0.9999997019767761, 1, -1, -1, 1, 1],
            "name": "box",
            "indices0": [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
            "normal": [0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, -2.831220058396866e-7, 0, 1, -2.831220058396866e-7, 0, 1, -2.831220058396866e-7, 0, 1, -2.831220058396866e-7, 0, -2.831220058396866e-7, -1, 0, -2.831220058396866e-7, -1, 0, -2.831220058396866e-7, -1, 0, -2.831220058396866e-7, -1, 0, -1, 2.235170057929281e-7, -1.3410999599727802e-7, -1, 2.235170057929281e-7, -1.3410999599727802e-7, -1, 2.235170057929281e-7, -1.3410999599727802e-7, -1, 2.235170057929281e-7, -1.3410999599727802e-7, 2.3841900542720396e-7, 1, 2.0861600091848231e-7, 2.3841900542720396e-7, 1, 2.0861600091848231e-7, 2.3841900542720396e-7, 1, 2.0861600091848231e-7, 2.3841900542720396e-7, 1, 2.0861600091848231e-7],
            "uv1": [0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1]
        }];
    </script>

    <script type="text/javascript" src="angel/webgl-utils.js"></script> <!-- Google WebGL Utils -->
    <script type="text/javascript" src="angel/initShaders.js"></script> <!-- Angel load shader from script -->
    <script type="text/javascript" src="angel/MV.js"></script> <!-- Angel matrix library -->

    <!--<script type="text/javascript" src="gl-matrix-min.js"></script>-->
    <script type="text/javascript" src="ex04.js"></script> <!-- Our code -->

</head>
<body>
    <canvas id="gl-canvas" width="500" height="500" style="border:1px solid black">
    Sorry, your browser doesn't support the HTML5 canvas element
    </canvas>
</body>
</html>